#计算机网络 

# 九. 媒体接入控制（介质访问控制）——广播信道
**媒体接入控制（介质访问控制）使用一对多的广播通信方式**

> **Medium Access Control**翻译成媒体接入控制，有些翻译成介质访问控制

## 局域网的数据链路层

-   局域网最主要的**特点**是：
    -   网络为一个单位所拥有；
    -   地理范围和站点数目均有限。

-   局域网具有如下**主要优点**：
    -   具有广播功能，从一个站点可很方便地访问全网。局域网上的主机可共享连接在局域网上的各种硬件和软件资源。
    -   便于系统的扩展和逐渐地演变，各设备的位置可灵活调整和改变。
    -   提高了系统的可靠性、可用性和残存性。
![[53 局域网拓扑结构.png]]

## 数据链路层的两个子层

为了使数据链路层能更好地适应多种局域网标准，IEEE 802 委员会就将局域网的数据链路层拆成**两个子层**：

1.  **逻辑链路控制** LLC (Logical Link Control)子层；
2.  **媒体接入控制** MAC (Medium Access Control)子层。

与接入到传输媒体有关的内容都放在 MAC子层，而 LLC 子层则与传输媒体无关。 **不管采用何种协议的局域网，对 LLC 子层来说都是透明的**。
![[54 数据链路层的子层.png]]

## 基本概念
为什么要媒体接入控制（介质访问控制）？
**共享信道带来的问题**
若多个设备在共享信道上同时发送数据，则会造成彼此干扰，导致发送失败。

共享信道要着重考虑的一个问题就是如何协调多个发送和接收站点对一个共享传输媒体的占
用，即**媒体接入控制**MAC(Medium Access Control)。
![[55 信号碰撞.png]]

随着技术的发展，交换技术的成熟和成本的降低，具有更高性能的使用点对点链路和链路层交换机的交换式局域网在有线领域已完全取代了共享式局域网，但由于无线信道的广播天性，无线局域网仍然使用的是共享媒体技术。

# 十. 静态划分信道
## 信道复用
■  复用 (Multiplexing)是通信技术中的一个重要概念。复用就是通过-条物理线路同时传输多路用户的信号。
■  当网络中传输媒体的传输容量大于多条单一 信道传输的总通信量时，可利用复用技术在一条物理线路上建立多条通信信道来充分利用传输媒体的带宽。
![[56 复用与分用.png]]

## 频分复用FDM (Frequency Division Multiplexing)
-   将整个带宽分为多份，用户在分配到一定的频带后，在通信过程中自始至终都占用这个频带。
-   **频分复用**的所有用户在同样的时间**占用不同的带宽资源**（请注意，这里的“带宽”是频率带宽而不是数据的发送速率）。
![[57 频分复用.png]]

## 时分复用TDM (Time Division Multiplexing)
-   **时分复用**则是将时间划分为一段段等长的**时分复用帧（TDM帧）**。每一个时分复用的用户在每一 TDM 帧中占用固定序号的时隙。
-   每一个用户所占用的时隙是**周期性地出现**（其周期就是TDM帧的长度）的。
-   TDM 信号也称为**等时** (isochronous) 信号。
-   **时分复用的所有用户在不同的时间占用同样的频带宽度。**
![[58 时分复用.png]]

## 波分复用 WDM(Wavelength Division Multiplexing)
![[59 波分复用.png]]
波分复用就是光的频分复用，使用一根光纤来同时传输多个光载波信号，光信号传输一段距离后悔衰减，所以要用 光纤放大器放大光信号。

## 码分复用 CDM (Code Division Multiplexing)
码分复用CDM是另一种共享信道的方法。实际上，由于该技术主要用于多址接入，人们更常用的名词是码分多址CDMA(Code Division Multiple Access)。
同理，频分复用FDM和时分复用TDM同样可用于多址接入,相应的名词是频分多址FDMA(Frequency Division Multiple Access)和时分多址TDMA(Time Division Multiple Access)。

在本部分内容中，我们不严格区分复用与多址的概念。可简单理解如下:
-  **复用**    是将单- -媒体的频带资源划分成很多子信道，这些子信道之间相互独立,互不干扰。从媒体的整体频带资源上看，每个子信道只占用该媒体频带资源的一部分。
-  **多址**   (更确切地应该称为多点接入)处理的是动态分配信道给用户。这在用户仅仅暂时性地占用信道的应用中是必须的，而所有的移动通信系统基本上都属于这种情况。相反，在信道永久性地分配给用户的应用中，多址是不需要的(对于无线广播或电视广播站就是这样)。
- 某种程度上，FDMA、TDMA、CDMA可以分别看成是FDM、TDM、CDM的应用。

与FDM和TDM不同，CDM的每-一个用户可以在同样的时间使用同样的频带进行通信。由于各用户使用经过特殊挑选的不同码型，因此各用户之间不会造成干扰。CDM最初是用于军事通信的，因为这种系统所发送的信号有很强的抗干扰能力,其频谱类似于白噪声，不易被敌人发现。
![[60 码分多址.png]]
随着技术的进步，CDMA设备的价格和体积都大幅度下降，因而现在已广泛用于民用的移动通信。
在CDMA中，每1个比特时间再划分为m个短的间隔，称为码片(Chip) 。通常m的值是64或128。为了简单起见，在后续的举例中，我们假设m为8。
使用CDMA的每一个站被指派一个唯一的`m bit`码片序列(Chip Sequence)。
- 一个站如果要发送比特1,则发送它自己的m bit码片序列；
- 一个站如果要发送比特0，则发送它自己的m bit码片序列的二进制反码；

【例题】指派给CDMA系统中某个站点的码片序列为00011011，发送比特1：发送自己的码片序列00011011，发送比特0：发送自 己的码片序列的二进制反码11100100。
为了方便，我们按惯例将码片序列中的0写为-1,将1写为+1。则该站点的码片序列是(-1 -1-1 +1 +1-1 +1 +1)。
码片序列的挑选原则如下:
1. 分配给每个站的码片序列必须各不相同，实际常采用伪随机码序列。
2. 分配给每个站的码片序列必须相互正交(规格化内积为0)。
令向量S表示站S的码片序列，令向量T表示其他任何站的码片序列。两个不同站S和T的码片序列正交，就是向量S和T的规格化内积为0：
![[61 码分多址.png]]

# 十一. 动态划分信道

## 随机接入（CSMA/CD协议）
基本概念：
**最初**的**以太网**是将许多计算机都连接到一根总线上。易于实现广播通信。当初认为这样的连接方法既简单又可靠，因为总线上没有有源器件。
![[62 CSMA CD.png]]

> **以太网（Ethernet）是一种计算机局域网技术**。IEEE组织的IEEE 802.3标准制定了**以太网（Ethernet）的技术标准**。
> 以太网采用无连接的工作方式，对发送的数据帧不进行编号，也不要求对方发回确认。目的站收到有差错帧就把它丢弃，其他什么也不做

![[63 MA CS CD.png]]
### 多址接入MA
表示许多主机以多点接入的方式连接在一根总线上。
![[64 MA多址接入.png]]

### 载波监听CS
是指每一个站在发送数据之前先要检测一下总线上是否有其他计算机在发送数据，如果有，则暂时不要发送数据，以免发生碰撞。
总线上并没有什么“载波”。因此， **“载波监听”就是用电子技术检测总线上有没有其他计算机发送的数据信号。**
![[65 载波监听.png]]
### 碰撞检测CD
-   **“碰撞检测”就是计算机边发送数据边检测**信道上的信号电压大小。
-   当几个站同时在总线上发送数据时，总线上的信号电压摆动值将会增大（互相叠加）。
-   当一个站检测到的信号电压摆动值超过一定的门限值时，就认为总线上至少有两个站同时在发送数据，表明产生了碰撞。
-   **所谓“碰撞”就是发生了冲突。因此“碰撞检测”也称为“冲突检测”。**
-   在发生碰撞时，总线上传输的信号产生了严重的失真，无法从中恢复出有用的信息来。
-   **每一个正在发送数据的站，一旦发现总线上出现了碰撞，就要立即停止发送，免得继续浪费网络资源，然后等待一段随机时间后再次发送。**
![[66 CD 碰撞检测.png]]
为什么要进行碰撞检测？ 因为信号传播时延对载波监听产生了影响。
![[67 碰撞.png]]
A 需要单程传播时延的 2 倍的时间，才能检测到与 B 的发送产生了冲突。

## CSMA/CD 协议工作流程
![[68 CSMA CD 协议工作流程.png]]
争用期（碰撞窗口）
![[69 争用期.png]]
- 主机最多经过$2 τ$(即$δ→0$ )的时长就可检测到本次发送是否遭受了碰撞。
- 因此，以太网的端到端往返传播时延2t称为争用期或碰撞窗口。
- 经过争用期这段时间还没有检测到碰撞，才能肯定这次发送不会发生碰撞。
- 每一个主机在自己发送帧之后的一小段时间内，存在着遭遇碰撞的可能性。这一-小段时间是不确定的。它取决于另-一个发送帧的主机到本主机的距离，但不会超过总线的端到端往返传播时延，即一个争用期时间。
- 显然，在以太网中发送帧的主机越多，端到端往返传播时延越大,发生碰撞的概率就越大。因此，共享式以太网不能连接太多的主机，使用的总线也不能太长。
	- 10Mb/s以太网把争用期定为512比特发送时间，即51.2μs, 因此其总线长度不能超过5120m, 但考虑到其他-一些因素，如信号衰减等，以太网规定总线长度不能超过2500m。

### CSMA/CD 协议工作——最小帧长
![[70 CSMA 最小帧长.png]]

> 以太网规定最小帧长为64字节，即512比特(512比特时间即为争用期) 。

-   如果要发送的数据非常少，那么必须加入一些填充字节,使帧长不小于64字节。
-  以太网的最小帧长确保了 主机可在帧发送完成之前就检测到该帧的发送过程中是否遭遇了碰撞;
	-   如果在争用期(共发送64字节) 没有检测到碰撞，那么后续发送的数据就-定不会发生碰撞;
	-   如果在争用期内检测到碰撞，就立即中止发送，这时已经发送出去的数据一定小于64字节， 因此，凡长度**小于64字节的帧都是由于碰撞而异常中止的无效帧**。

### CSMA/CD 协议工作——最大帧长
![[71 CSMA 最大帧长.png]]
![[72 CSMA 最大帧长.png]]
### CSMA/CD 协议工作——截断二进制指数退避算法
![[73 截断二进制指数退避算法.png]]
### CSMA/CD 协议工作——信道利用率
![[74 信道利用率.png]]
### CSMA/CD 协议工作——帧接收流程
![[75 帧接收流程.png]]
-   使用 CSMA/CD 协议的以太网不能进行全双工通信而**只能进行双向交替通信（半双工通信）。**
-   每个站在发送数据之后的一小段时间内，存在着遭遇碰撞的可能性。
-   这种**发送的不确定性**使整个以太网的平均通信量远小于以太网的最高数据率。

> CSMA/CD协议曾经用于各种总线结构以太网和双绞线以太网的早起版本中。
> **现在的以太网基于交换机和全双工连接，不会有碰撞，因此没有必要使用CSMA/CS协议**。

## 随机接入（CSMA/CA协议）
无线局域网使用的协议：CSMA/CA（Avoid），为什么无线局域网要使用CSMA/CA协议？

【问题】既然CSMA/CD协议已经成功地应用于使用广播信道的有线局域网，那么同样使用广播信道的无线局域网能不能也使用CSMA/CD协议呢?
【解答】
在无线局域网中，仍然可以使用载波监听多址接入CSMA，即在发送帧之前先对传输媒体进行载波监听。若发现有其他站在发送帧，就推迟发送以免发生碰撞。
在无线局域网中， 不能使用碰撞检测CD，原因如下: 
- 由于无线信道的传输条件特殊，其信号强度的动态范围非常大，无线网卡上接收到的信号强度往往会远远小于发送信号的强度(可能相差百万倍)。**如果要在无线网卡上实现碰撞检测CD，对硬件的要求非常高**。
- 即使能够在硬件上实现无线局域网的碰撞检测功能，但由于无线电波传播的特殊性(存在隐蔽站问题)，**进行碰撞检测的意义也不大**。
![[76 CSMA CA.png]]

802.11无线局域网使用CSMA/CA协议，在CSMA的基础上增加了一个碰撞避免CA功能，而不再实现碰撞检测功能。
由于不可能避免所有的碰撞，并且无线信道误码率较高，802.1 1标准还使用了数据链路层确认机制(停止-等待协议)来保证数据被正确接收。
802.11的MAC层标准定义了两种不同的媒体接入控制方式:
- **分布式协调功能**DCF(Distributed Coordination Function)。在DCF方式下，没有中心控制站点，每个站点使用CSMA/CA协议通过争用信道来获取发送权，这是802.11定义的默认方式。
- **点协调功能**PCF(Point Coordination Function)。PCF方式使用集中控制的接入算法(一般在接入点AP实现集中控制)，是802.11定义的可选方式， 在实际中较少使用。

### 帧间间隔IFS（Inter-Frame Space）
-  802.11标准规定， 所有的站点**必须在持续检测到信道空闲一段指定时间后才能发送帧**，这段时间称为帧间间隔IFS。
- 帧间间隔的长短取决于该站点要发送的帧的类型:
	-   高优先级帧需要等待的时间较短，因此可优先获得发送权；
	-   低优先级帧需要等待的时间较长。若某个站的低优先级帧还没来得及发送，而其他站的高优先级帧已发送到信道上，则信道变为忙态，因而低优先级帧就只能再推迟发送了。这样就减少了发生碰撞的机会。
- 常用的两种帧间间隔如下:
	- 短帧间间隔SIFS(28μs)，是最短的帧间间隔，用来分隔开属于一次对话的各帧。一个站点应当能够在这段时间内从发送方式切换到接收方式。
	- 使用SIFS的帧类型有ACK帧、CTS帧、 由过长的MAC帧分片后的数据帧、以及所有回答AP探询的帧和在PCF方式中接入点AP发送出的任何帧。
	- DCF帧间间隔DIFS(128μs), 它比短帧间间隔SIFS要长得多，在DCF方式中用来发送数据帧和管理帧。

### CSMA/CA协议的工作原理
![[77 CSMA CA 工作原理.png]]
**源站为什么在检测到信道空闲后还要再等待一段时间DIFS？**
-   考虑到可能有其他的站有高优先级的帧要发送。若有，就要让高优先级帧先发送。

**目的站为什么正确接收数据帧后还要等待一段时间SIFS才能发送ACK帧？**
-   SIFS是最短的帧间间隔，用来分隔开属于一次对话的各帧，在这段时间内，一个站点应当能够从发送方式切换到接收方式
![[78 CSMA CA 工作原理.png]]
**信道由忙转为空闲且经过DIFS时间后，还要退避一段随机时间才能使用信道？**
- 防止多个站点同时发送数据而产生碰撞。

**使用退避算法的时机**
- 当站点检测到信道是空闲的， 并且所发送的数据帧不是成功发送完上一个数据帧之后立即连续发送的数据帧，则不使用退避算法。
- 以下情况必须使用退避算法:
	-   在发送数据帧之前检测到信道处于忙状态时；
	-   在每一次重传一个数据帧时；
	-   在每一次成功发送后要连续发送下一个帧时（这是为了避免-个站点长时间占用信道）。

### CSMA/CA协议的退避算法
- 在执行退避算法时， 站点为退避计时器设置-个随机的退避时间：
	- 当退避计时器的时间减小到零时，就开始发送数据；
	- 当退避计时器的时间还未减小到零时而信道又转变为忙状态,这时就冻结退避计时器的数值，重新等待信道变为空闲，再经过时间DIFS后，继续启动退避计时器。
- 在进行第`i`次退避时， 退避时间在时隙编号`{0, 1, ... 2*! 1}`中随机选择一个,然后乘以基本退避时间（也就是一一个时隙的长度）就可以得到随机的退避时间。这样做是为了使不同站点选择相同退避时间的概率减少。当时隙编号达到255时(对应于第6次退避)就不再增加了。
![[79 CSMA CA协议的退避算法.png]]

### CSMA/CA协议的信道预约和虚拟载波监听
为了**尽可能减少碰撞的概率和降低碰撞**的影响，802.11标准允许要发送数据的站点对信道进行预约。
1. 源站在发送数据帧之前先发送一个短的控制帧，称为请求发送RTS(Request To Send),它包括源地址、目的地址以及这次通信(包括相应的确认帧)所需的持续时间。
2. 若目的站正确收到源站发来的RTS帧，且媒体空闲，就发送一个响应控制帧,称为允许发送CTS(Clear To Send)，它也包括这次通信所需的持续时间(从RTS帧中将此持续时间复制到CTS帧中)。
3. 源站收到CTS帧后，再等待-段时间SIFS后,就可发送其数据帧。
4. 若目的站正确收到了源站发来的数据帧,在等待时间SIFS后,就向源站发送确认帧ACK。
![[80 CSMA CA协议的信道预约和虚拟载波监听.png]]

除源站和目的站以外的**其他各站**， 在收**到CTS帧(或数据帧)后就推迟接入到无线局域网中**。这样就保证了源站和目的站之间的通信不会受到其他站的干扰。
如果RTS帧发生碰撞,源站就收不到CTS帧，需执行退避算法重传RTS帧。
由于**RTS帧和CTS帧**很短，**发送碰撞的概率、碰撞产生的开销及本身的开销都很小**。而对于一般的数据帧，其发送时延往往大于传播时延(因为是局域网)，碰撞的概率很大，且一旦发生碰撞而导致数据帧重发，则浪费的时间就很多，因此**用很小的代价对信道进行预约**往往是值得的。802.11标准规定了3种情况供用户选择：
- 使用RTS帧和CTS帧；
- 不使用RTS帧和CTS帧；
- 只有当数据帧的长度超过某一 数值时才使用RTS帧和CTS帧。
![[81 CSMA CA协议的信道预约和虚拟载波监听.png]]
- 除RTS帧和CTS帧会携带通信需要持续的时间，数据帧也能携带通信需要持续的时间，这称为802.11的**虚拟载波监听机制**。
- 由于利用虚拟载波监听机制，**站点只要监听到RTS帧、CTS帧或数据帧中的任何一个，就能知道信道被占用的持续时间**，而不需要真正监听到信道.上的信号，因此**虚拟载波监听机制能减少隐蔽站带来的碰撞问题**。
![[82 互为隐蔽站.png]]

![[83 CSMA-CD与CA的区别.png]]
## 补充 IEEE802标准
1980年2月，由IEEE协会LAN/MAN标准委员会制定。

- MAC子层和LLC子层：
IEEE 802标准所描述的局域网参考模型只对应OSI参考模型的数据链路层与物理层，它将数据链路层划分为**逻辑链路层LLC子层**和**介质访问控制MAC子层**。
1. LLC子层：
识别网络层协议，然后对其进行封装。
为网络层提供服务：无确认无连接、面向连接、待确认无连接、告诉传送。
2. MAC子层：
数据帧的封装/卸装，帧的寻址和识别，帧的接受和发送，链路管理，帧差错控制等。MAC子层屏蔽了链路种类的差异性。
